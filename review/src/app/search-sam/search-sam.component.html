<mat-card>
  <mat-card-header>
    <mat-icon mat-card-avatar>manage_search</mat-icon>
    <mat-card-title>Search SAM</mat-card-title>
    <mat-card-subtitle>Search the SAM database by company, NAICS, city, or state</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <mat-form-field appearance="outline" style="width: 100%; margin-bottom: 16px;">
      <mat-label>Search Term</mat-label>
      <input matInput [(ngModel)]="term" placeholder="e.g., Fargo, 541512, Tech">
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>
    
    <!-- Data Source Status -->
    <div *ngIf="leads.length > 0" style="background: linear-gradient(135deg, rgba(255,152,0,0.1), rgba(255,193,7,0.1)); border-left: 4px solid #FF9800; padding: 12px; margin-bottom: 16px; border-radius: 8px;">
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
        <mat-icon style="color: #FF9800;">info</mat-icon>
        <strong style="color: #F57C00;">Data Source Status</strong>
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; font-size: 13px;">
        <div style="display: flex; align-items: center; gap: 6px;">
          <mat-icon style="color: #f44336; font-size: 18px;">cloud_off</mat-icon>
          <span><strong>SAM.gov API:</strong> 0 records</span>
        </div>
        <div style="display: flex; align-items: center; gap: 6px;">
          <mat-icon style="color: #f44336; font-size: 18px;">cloud_off</mat-icon>
          <span><strong>FPDS-NG:</strong> 0 records</span>
        </div>
        <div style="display: flex; align-items: center; gap: 6px;">
          <mat-icon style="color: #f44336; font-size: 18px;">cloud_off</mat-icon>
          <span><strong>USA Spending:</strong> 0 records</span>
        </div>
        <div style="display: flex; align-items: center; gap: 6px;">
          <mat-icon style="color: #4CAF50; font-size: 18px;">science</mat-icon>
          <span><strong>Seeded Data:</strong> {{leads.length}} records</span>
        </div>
      </div>
    </div>
    
    <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 16px; flex-wrap: wrap;">
      <button mat-raised-button color="primary" (click)="search()" [disabled]="!term || loading">
        <mat-icon>search</mat-icon> Search
      </button>
      
      <button mat-stroked-button (click)="showNaicsCodes = !showNaicsCodes" *ngIf="leads.length > 0">
        <mat-icon>{{showNaicsCodes ? 'visibility' : 'visibility_off'}}</mat-icon>
        {{showNaicsCodes ? 'Hide' : 'Show'}} NAICS Codes
      </button>
      
      <button mat-stroked-button 
              (click)="showSampleData = !showSampleData" 
              *ngIf="leads.length > 0 && sampleCount > 0"
              [matBadge]="sampleCount.toString()" 
              [matBadgeColor]="showSampleData ? 'primary' : 'warn'"
              matBadgeSize="small"
              [color]="showSampleData ? 'primary' : 'accent'">
        <mat-icon>{{showSampleData ? 'visibility' : 'visibility_off'}}</mat-icon>
        Sample Data: {{showSampleData ? 'ON' : 'OFF'}}
      </button>
      
      <div *ngIf="leads.length > 0" style="display: flex; gap: 8px; margin-left: auto;">
        <mat-chip *ngIf="sampleCount > 0" style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white;">
          <mat-icon>science</mat-icon>
          {{sampleCount}} Sample
        </mat-chip>
        <mat-chip *ngIf="testCount > 0" style="background: linear-gradient(135deg, #f44336, #d32f2f); color: white;">
          <mat-icon>bug_report</mat-icon>
          {{testCount}} Test
        </mat-chip>
        <mat-chip *ngIf="realCount > 0" style="background: linear-gradient(135deg, #4CAF50, #388E3C); color: white;">
          <mat-icon>check_circle</mat-icon>
          {{realCount}} Real
        </mat-chip>
      </div>
    </div>
    
    <mat-spinner *ngIf="loading" diameter="40" style="margin: 20px auto;"></mat-spinner>
    
    <div *ngIf="!loading && hasRun && leads.length === 0" class="no-results">
      <mat-icon color="warn">error_outline</mat-icon>
      <p class="error-text">No results found for "{{term}}"</p>
    </div>
    
    <div *ngIf="!loading && searchTotal > 0" class="total-results">
      <mat-icon>info</mat-icon>
      <span>Found {{searchTotal}} result{{searchTotal > 1 ? 's' : ''}}</span>
    </div>
    
    <mat-list *ngIf="filteredLeads.length > 0">
      <mat-list-item *ngFor="let lead of filteredLeads" 
                     (click)="toggleExpand(lead.leadId)"
                     class="clickable" 
                     title="Click to expand contracts">
        <mat-icon matListItemIcon>business</mat-icon>
        <div matListItemTitle>{{lead.companyName}}</div>
        <div matListItemLine>
          <strong>ID:</strong> {{lead.leadId}}
          <span *ngIf="showNaicsCodes"> | <strong>NAICS:</strong> {{lead.naicsCode}}
          <span *ngIf="lead.naicsDescription">- {{lead.naicsDescription}}</span></span>
           | <strong>Location:</strong> {{lead.city}}, {{lead.stateCode}}
        </div>
        <div matListItemLine>
          <strong>Status:</strong> {{lead.registrationStatus}}
          <span *ngIf="lead.contracts && lead.contracts.length > 0"> | 
            <strong>{{lead.contracts.length}} Contract{{lead.contracts.length > 1 ? 's' : ''}}</strong> (${{calculateTotalValue(lead.contracts)}})
          </span>
          <mat-chip-set *ngIf="lead.businessType && lead.businessType.length > 0" style="display: inline-flex; vertical-align: middle;">
            <mat-chip *ngFor="let type of lead.businessType.slice(0, 2)">{{type}}</mat-chip>
          </mat-chip-set>
          <mat-chip *ngIf="hasSampleContracts(lead)" class="sample-indicator">
            <mat-icon>science</mat-icon> Sample
          </mat-chip>
          <mat-chip *ngIf="hasRealContracts(lead)" class="real-indicator">
            <mat-icon>verified</mat-icon> Real
          </mat-chip>
          <mat-icon class="expand-icon" *ngIf="lead.contracts && lead.contracts.length > 0">{{isExpanded(lead.leadId) ? 'expand_less' : 'expand_more'}}</mat-icon>
        </div>
        
        <!-- Expanded Contract Details -->
        <div *ngIf="isExpanded(lead.leadId) && lead.contracts && lead.contracts.length > 0" 
             class="contracts-expanded"
             tabindex="0"
             role="region"
             [attr.aria-label]="'Contract details for ' + lead.companyName"
             (click)="$event.stopPropagation()"
             (keydown.enter)="$event.stopPropagation()"
             (keydown.space)="$event.stopPropagation()">
          <div *ngFor="let contract of lead.contracts" 
               class="contract-detail" 
               [class.sample-contract]="contract.isSample" 
               [class.real-contract]="!contract.isSample && !contract.isTest"
               [class.test-contract]="contract.isTest">
            <div class="contract-header">
              <mat-icon>description</mat-icon>
              <strong>{{contract.contractNumber}}</strong>
              <span class="contract-badge">{{contract.isSample ? 'SAMPLE' : contract.isTest ? 'TEST' : 'REAL'}}</span>
            </div>
            <div class="contract-title">{{contract.title}}</div>
            <div class="contract-description" *ngIf="contract.description">
              {{contract.description}}
            </div>
            <div class="contract-info">
              <span class="contract-value">
                <mat-icon>attach_money</mat-icon>
                ${{formatValue(contract.value)}}
              </span>
              <span class="contract-status">
                <mat-icon>{{contract.status === 'Active' ? 'check_circle' : 'done'}}</mat-icon>
                {{contract.status}}
              </span>
              <span class="contract-date">
                <mat-icon>calendar_today</mat-icon>
                {{contract.awardDate | date:'MMM d, y'}}
              </span>
            </div>
          </div>
        </div>
      </mat-list-item>
    </mat-list>
  </mat-card-content>
</mat-card>
